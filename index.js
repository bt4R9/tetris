var Q=Object.defineProperty;var Z=(p,t,e)=>t in p?Q(p,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):p[t]=e;var r=(p,t,e)=>(Z(p,typeof t!="symbol"?t+"":t,e),e),W=(p,t,e)=>{if(!t.has(p))throw TypeError("Cannot "+e)};var y=(p,t,e)=>(W(p,t,"read from private field"),e?e.call(p):t.get(p)),R=(p,t,e)=>{if(t.has(p))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(p):t.set(p,e)},F=(p,t,e,i)=>(W(p,t,"write to private field"),i?i.call(p,e):t.set(p,e),e);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))i(s);new MutationObserver(s=>{for(const n of s)if(n.type==="childList")for(const o of n.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&i(o)}).observe(document,{childList:!0,subtree:!0});function e(s){const n={};return s.integrity&&(n.integrity=s.integrity),s.referrerpolicy&&(n.referrerPolicy=s.referrerpolicy),s.crossorigin==="use-credentials"?n.credentials="include":s.crossorigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function i(s){if(s.ep)return;s.ep=!0;const n=e(s);fetch(s.href,n)}})();const $=0,T=1;class t0{constructor(){r(this,"width",15);r(this,"height",30);r(this,"grid");r(this,"shape",null);r(this,"collapsed",null);this.grid=[],this.clean()}clean(){for(let t=0;t<this.height;t++){this.grid[t]=[];for(let e=0;e<this.width;e++)this.grid[t][e]=$}}attachShape(){if(this.shape){for(const[t,e]of this.shape.points)this.grid[t][e]=T;this.collapse()}}collapse(){for(let t=this.grid.length-1;t>0;t--){let e=!0;for(let i=0;i<this.grid[t].length;i++)this.grid[t][i]===0&&(e=!1);if(e){this.collapsed={y:t};break}}}collapseRows(){if(!this.collapsed)return;let t=this.collapsed.y;for(;t>0;){for(let e=0;e<this.grid[t].length;e++)this.grid[t][e]=this.grid[t-1][e],this.grid[t-1][e]=0;t-=1}this.collapsed=null,this.collapse()}canPlaceShape(t){const{width:e,height:i}=this;for(let s=0;s<t.grid.length;s++)for(let n=0;n<t.grid[s].length;n++){if(t.grid[s][n]===$)continue;const o=s+t.dy,l=n+t.dx;if(l<0||l>e-1||o<0||o>i-1||this.grid[o][l]===T)return!1}return!0}}var j={exports:{}};(function(p){var t=Object.prototype.hasOwnProperty,e="~";function i(){}Object.create&&(i.prototype=Object.create(null),new i().__proto__||(e=!1));function s(d,h,a){this.fn=d,this.context=h,this.once=a||!1}function n(d,h,a,c,u){if(typeof a!="function")throw new TypeError("The listener must be a function");var _=new s(a,c||d,u),g=e?e+h:h;return d._events[g]?d._events[g].fn?d._events[g]=[d._events[g],_]:d._events[g].push(_):(d._events[g]=_,d._eventsCount++),d}function o(d,h){--d._eventsCount===0?d._events=new i:delete d._events[h]}function l(){this._events=new i,this._eventsCount=0}l.prototype.eventNames=function(){var h=[],a,c;if(this._eventsCount===0)return h;for(c in a=this._events)t.call(a,c)&&h.push(e?c.slice(1):c);return Object.getOwnPropertySymbols?h.concat(Object.getOwnPropertySymbols(a)):h},l.prototype.listeners=function(h){var a=e?e+h:h,c=this._events[a];if(!c)return[];if(c.fn)return[c.fn];for(var u=0,_=c.length,g=new Array(_);u<_;u++)g[u]=c[u].fn;return g},l.prototype.listenerCount=function(h){var a=e?e+h:h,c=this._events[a];return c?c.fn?1:c.length:0},l.prototype.emit=function(h,a,c,u,_,g){var b=e?e+h:h;if(!this._events[b])return!1;var f=this._events[b],w=arguments.length,x,m;if(f.fn){switch(f.once&&this.removeListener(h,f.fn,void 0,!0),w){case 1:return f.fn.call(f.context),!0;case 2:return f.fn.call(f.context,a),!0;case 3:return f.fn.call(f.context,a,c),!0;case 4:return f.fn.call(f.context,a,c,u),!0;case 5:return f.fn.call(f.context,a,c,u,_),!0;case 6:return f.fn.call(f.context,a,c,u,_,g),!0}for(m=1,x=new Array(w-1);m<w;m++)x[m-1]=arguments[m];f.fn.apply(f.context,x)}else{var z=f.length,v;for(m=0;m<z;m++)switch(f[m].once&&this.removeListener(h,f[m].fn,void 0,!0),w){case 1:f[m].fn.call(f[m].context);break;case 2:f[m].fn.call(f[m].context,a);break;case 3:f[m].fn.call(f[m].context,a,c);break;case 4:f[m].fn.call(f[m].context,a,c,u);break;default:if(!x)for(v=1,x=new Array(w-1);v<w;v++)x[v-1]=arguments[v];f[m].fn.apply(f[m].context,x)}}return!0},l.prototype.on=function(h,a,c){return n(this,h,a,c,!1)},l.prototype.once=function(h,a,c){return n(this,h,a,c,!0)},l.prototype.removeListener=function(h,a,c,u){var _=e?e+h:h;if(!this._events[_])return this;if(!a)return o(this,_),this;var g=this._events[_];if(g.fn)g.fn===a&&(!u||g.once)&&(!c||g.context===c)&&o(this,_);else{for(var b=0,f=[],w=g.length;b<w;b++)(g[b].fn!==a||u&&!g[b].once||c&&g[b].context!==c)&&f.push(g[b]);f.length?this._events[_]=f.length===1?f[0]:f:o(this,_)}return this},l.prototype.removeAllListeners=function(h){var a;return h?(a=e?e+h:h,this._events[a]&&o(this,a)):(this._events=new i,this._eventsCount=0),this},l.prototype.off=l.prototype.removeListener,l.prototype.addListener=l.prototype.on,l.prefixed=e,l.EventEmitter=l,p.exports=l})(j);const e0=j.exports;class i0{constructor(){r(this,"events",new e0);r(this,"onKeyDown",t=>{const{events:e}=this;switch(t.key){case"ArrowLeft":e.emit("key",{key:"L"});break;case"ArrowRight":e.emit("key",{key:"R"});break;case"ArrowUp":e.emit("key",{key:"U"});break;case"ArrowDown":e.emit("key",{key:"D"});break;case" ":e.emit("key",{key:"S"});break}});r(this,"onKeyUp",()=>{this.events.emit("keyUp")})}init(){return document.addEventListener("keydown",this.onKeyDown),document.addEventListener("keyup",this.onKeyUp),()=>{document.removeEventListener("keydown",this.onKeyDown),document.removeEventListener("keyup",this.onKeyUp)}}}var A,M,K,O,S,k;class s0{constructor({canvas:t,context:e,board:i}){r(this,"canvas");r(this,"context");r(this,"board");r(this,"size",15);R(this,A,-1);R(this,M,-1);R(this,K,1e3/30);R(this,O,0);R(this,S,15);R(this,k,15);r(this,"x0");r(this,"y0");r(this,"x1");r(this,"y1");r(this,"gap",1);r(this,"draw",()=>{var s;F(this,A,requestAnimationFrame(this.draw));const t=Date.now(),e=t-y(this,M);if(e<y(this,K))return;F(this,M,t-e%y(this,K)),F(this,O,(y(this,O)+1)%10),this.context.fillStyle="#fff",this.context.fillRect(y(this,k),y(this,S),12*20,16*30);const i=new Set(((s=this.board.shape)==null?void 0:s.points.map(([n,o])=>`${n}-${o}`))??[]);for(let n=0;n<this.board.height;n++){const o=n*this.size;for(let l=0;l<this.board.width;l++){const d=l*this.size,h=o+this.gap*n+y(this,S),a=d+this.gap*l+y(this,k);this.board.grid[n][l]===T&&(this.context.fillStyle="#000",this.context.fillRect(a,h,this.size,this.size)),i.has(`${n}-${l}`)&&(this.context.fillStyle="#9E9E9E",this.context.fillRect(a,h,this.size,this.size))}}if(this.board.collapsed){this.context.fillStyle=y(this,O)%2==0?"#9E9E9E":"#000";const n=this.board.collapsed.y,o=n*this.size+this.gap*n+y(this,S);for(let l=0;l<this.board.width;l++){const d=l*this.size+this.gap*l+y(this,k);this.context.fillRect(d,o,this.size,this.size)}}});this.canvas=t,this.context=e,this.board=i,this.x0=y(this,S)+this.gap,this.y0=y(this,k)+this.gap,this.x1=this.board.width*(this.gap+this.size)+y(this,k)*2,this.y1=this.board.height*(this.gap+this.size)+y(this,S)*2,this.context=e,this.drawGameBoard()}start(){this.draw()}stop(){cancelAnimationFrame(y(this,A))}drawGameBoard(){const{context:t,x0:e,y0:i,x1:s,y1:n}=this;this.context.fillStyle="#fff",this.context.fillRect(0,0,this.canvas.width,this.canvas.height),t.lineWidth=.5,t.strokeStyle="#000";const o=4.5;t.beginPath(),t.moveTo(e-o,i-o),t.lineTo(e-o,n-y(this,S)+o/2),t.stroke(),t.beginPath(),t.moveTo(e-o,i-o),t.lineTo(s-y(this,k)+o/2,i-o),t.stroke(),t.beginPath(),t.moveTo(s-y(this,k)+o/2,i-o),t.lineTo(s-y(this,k)+o/2,n-y(this,S)+o/2),t.stroke(),t.beginPath(),t.moveTo(e-o,n-y(this,S)+o/2),t.lineTo(s-y(this,k)+o/2,n-y(this,S)+o/2),t.stroke()}}A=new WeakMap,M=new WeakMap,K=new WeakMap,O=new WeakMap,S=new WeakMap,k=new WeakMap;const r0={32:[[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0]],33:[[0,1,0,0],[0,1,0,0],[0,1,0,0],[0,0,0,0],[0,1,0,0]],34:[[1,0,1,0],[1,0,1,0],[0,0,0,0],[0,0,0,0],[0,0,0,0]],39:[[0,0,0,0],[0,1,0,0],[0,1,0,0],[0,0,0,0],[0,0,0,0]],40:[[0,0,1,1],[0,1,0,0],[0,1,0,0],[0,1,0,0],[0,0,1,1]],41:[[1,1,0,0],[0,0,1,0],[0,0,1,0],[0,0,1,0],[1,1,0,0]],44:[[0,0,0,0],[0,0,0,0],[0,0,1,0],[0,0,1,0],[0,1,0,0]],45:[[0,0,0,0],[0,0,0,0],[0,1,1,0],[0,0,0,0],[0,0,0,0]],46:[[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,1,0,0]],48:[[1,1,1,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,1,1,1]],49:[[0,0,1,0],[0,1,1,0],[0,0,1,0],[0,0,1,0],[0,0,1,0]],50:[[1,1,1,1],[0,0,0,1],[1,1,1,1],[1,0,0,0],[1,1,1,1]],51:[[1,1,1,1],[0,0,0,1],[1,1,1,1],[0,0,0,1],[1,1,1,1]],52:[[1,0,0,1],[1,0,0,1],[1,1,1,1],[0,0,0,1],[0,0,0,1]],53:[[1,1,1,1],[1,0,0,0],[1,1,1,1],[0,0,0,1],[1,1,1,1]],54:[[1,1,1,1],[1,0,0,0],[1,1,1,1],[1,0,0,1],[1,1,1,1]],55:[[1,1,1,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1]],56:[[1,1,1,1],[1,0,0,1],[1,1,1,1],[1,0,0,1],[1,1,1,1]],57:[[1,1,1,1],[1,0,0,1],[1,1,1,1],[0,0,0,1],[1,1,1,1]],58:[[0,0,0,0],[0,1,0,0],[0,0,0,0],[0,1,0,0],[0,0,0,0]],59:[[0,1,0,0],[0,0,0,0],[0,0,0,0],[0,1,0,0],[1,0,0,0]],61:[[0,0,0,0],[0,1,1,0],[0,0,0,0],[0,1,1,0],[0,0,0,0]],63:[[0,1,1,0],[1,0,0,1],[0,0,1,0],[0,0,0,0],[0,1,0,0]],65:[[0,1,1,0],[1,0,0,1],[1,1,1,1],[1,0,0,1],[1,0,0,1]],66:[[1,1,1,0],[1,0,0,1],[1,1,1,0],[1,0,0,1],[1,1,1,0]],67:[[0,1,1,1],[1,0,0,0],[1,0,0,0],[1,0,0,0],[0,1,1,1]],68:[[1,1,1,0],[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,1,1,0]],69:[[1,1,1,1],[1,0,0,0],[1,1,1,0],[1,0,0,0],[1,1,1,1]],70:[[1,1,1,1],[1,0,0,0],[1,1,1,0],[1,0,0,0],[1,0,0,0]],71:[[0,1,1,1],[1,0,0,0],[1,0,1,1],[1,0,0,1],[0,1,1,1]],72:[[1,0,0,1],[1,0,0,1],[1,1,1,1],[1,0,0,1],[1,0,0,1]],73:[[0,1,0,0],[0,1,0,0],[0,1,0,0],[0,1,0,0],[0,1,0,0]],74:[[0,0,0,1],[0,0,0,1],[0,0,0,1],[1,0,0,1],[0,1,1,0]],75:[[1,0,0,1],[1,0,1,0],[1,1,0,0],[1,0,1,0],[1,0,0,1]],76:[[1,0,0,0],[1,0,0,0],[1,0,0,0],[1,0,0,0],[1,1,1,0]],77:[[1,0,0,1],[1,1,1,1],[1,0,0,1],[1,0,0,1],[1,0,0,1]],78:[[1,0,0,1],[1,1,0,1],[1,0,1,1],[1,0,0,1],[1,0,0,1]],79:[[0,1,1,0],[1,0,0,1],[1,0,0,1],[1,0,0,1],[0,1,1,0]],80:[[1,1,1,0],[1,0,0,1],[1,1,1,0],[1,0,0,0],[1,0,0,0]],81:[[0,1,1,0],[1,0,0,1],[1,0,0,1],[1,0,1,1],[0,1,1,1]],82:[[1,1,1,0],[1,0,0,1],[1,1,1,0],[1,0,1,0],[1,0,0,1]],83:[[0,1,1,1],[1,0,0,0],[0,1,1,0],[0,0,0,1],[1,1,1,0]],84:[[1,1,1,0],[0,1,0,0],[0,1,0,0],[0,1,0,0],[0,1,0,0]],85:[[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,1,1,1]],86:[[1,0,1,0],[1,0,1,0],[1,0,1,0],[1,0,1,0],[0,1,0,0]],87:[[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,1,1,1],[1,0,0,1]],88:[[1,0,1,0],[1,0,1,0],[0,1,0,0],[1,0,1,0],[1,0,1,0]],89:[[1,0,1,0],[1,0,1,0],[1,1,1,0],[0,1,0,0],[0,1,0,0]],90:[[1,1,1,1],[0,0,0,1],[0,0,1,0],[0,1,0,0],[1,1,1,1]],95:[[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[1,1,1,1]]},n0={44:{dy:2,dx:0},95:{dy:2,dx:0}},o0=1;class U{constructor(t){r(this,"name");r(this,"ascii_table");r(this,"ascii_modifiers");r(this,"symbol_width");r(this,"symbol_height");r(this,"backup_symbol_grid");r(this,"new_line_symbol");r(this,"separator_symbol");r(this,"default_gap");r(this,"default_size");r(this,"default_inter_letter_width");r(this,"default_inter_letter_height");const{name:e,ascii_table:i,ascii_modifiers:s,symbol_width:n,symbol_height:o,backup_symbol_grid:l,new_line_symbol:d,separator_symbol:h,default_size:a,default_gap:c,default_inter_letter_width:u,default_inter_letter_height:_}=t;this.name=e,this.ascii_table=i,this.ascii_modifiers=s,this.symbol_width=n,this.symbol_height=o,this.backup_symbol_grid=l,this.new_line_symbol=d,this.separator_symbol=h,this.default_size=a,this.default_gap=c,this.default_inter_letter_width=u,this.default_inter_letter_height=_}}new U({name:"Mono_4x5",ascii_table:r0,ascii_modifiers:n0,symbol_width:4,symbol_height:5,backup_symbol_grid:[[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1]],new_line_symbol:10,separator_symbol:32,default_inter_letter_width:1,default_inter_letter_height:4,default_gap:0,default_size:1});const h0={32:[[0,0,0,0,0],[0,0,0,0,0],[0,0,0,0,0],[0,0,0,0,0],[0,0,0,0,0],[0,0,0,0,0],[0,0,0,0,0]],33:[[0,0,1,0,0],[0,0,1,0,0],[0,0,1,0,0],[0,0,1,0,0],[0,0,1,0,0],[0,0,0,0,0],[0,0,1,0,0]],34:[[0,1,0,1,0],[0,1,0,1,0],[0,1,0,1,0],[0,0,0,0,0],[0,0,0,0,0],[0,0,0,0,0],[0,0,0,0,0]],39:[[0,0,0,0,0],[0,0,1,0,0],[0,0,1,0,0],[0,0,0,0,0],[0,0,0,0,0],[0,0,0,0,0],[0,0,0,0,0]],40:[[0,0,0,1,1],[0,0,1,0,0],[0,0,1,0,0],[0,0,1,0,0],[0,0,1,0,0],[0,0,1,0,0],[0,0,0,1,1]],41:[[1,1,0,0,0],[0,0,1,0,0],[0,0,1,0,0],[0,0,1,0,0],[0,0,1,0,0],[0,0,1,0,0],[1,1,0,0,0]],44:[[0,0,0,0,0],[0,0,0,0,0],[0,0,0,0,0],[0,0,0,0,0],[0,0,0,1,0],[0,0,0,1,0],[0,0,1,0,0]],45:[[0,0,0,0,0],[0,0,0,0,0],[0,0,0,0,0],[0,1,1,1,0],[0,0,0,0,0],[0,0,0,0,0],[0,0,0,0,0]],46:[[0,0,0,0,0],[0,0,0,0,0],[0,0,0,0,0],[0,0,0,0,0],[0,0,0,0,0],[0,0,0,0,0],[0,0,1,0,0]],48:[[0,1,1,1,0],[1,0,0,0,1],[1,0,0,1,1],[1,0,1,0,1],[1,1,0,0,1],[1,0,0,0,1],[0,1,1,1,0]],49:[[0,0,1,0,0],[0,1,1,0,0],[0,0,1,0,0],[0,0,1,0,0],[0,0,1,0,0],[0,0,1,0,0],[0,1,1,1,0]],50:[[0,1,1,1,0],[1,0,0,0,1],[0,0,0,0,1],[0,0,0,1,0],[0,0,1,0,0],[0,1,0,0,0],[1,1,1,1,1]],51:[[1,1,1,1,1],[0,0,0,1,0],[0,0,1,0,0],[0,0,0,1,0],[0,0,0,0,1],[1,0,0,0,1],[0,1,1,1,0]],52:[[0,0,0,1,0],[0,0,1,1,0],[0,1,0,1,0],[1,1,1,1,1],[0,0,0,1,0],[0,0,0,1,0],[0,0,0,1,0]],53:[[1,1,1,1,1],[1,0,0,0,0],[1,1,1,1,0],[0,0,0,0,1],[0,0,0,0,1],[1,0,0,0,1],[0,1,1,1,0]],54:[[0,0,1,1,0],[0,1,0,0,0],[1,0,0,0,0],[1,1,1,1,0],[1,0,0,0,1],[1,0,0,0,1],[0,1,1,1,0]],55:[[1,1,1,1,1],[0,0,0,0,1],[0,0,0,1,0],[0,0,1,0,0],[0,1,0,0,0],[0,1,0,0,0],[0,1,0,0,0]],56:[[0,1,1,1,0],[1,0,0,0,1],[1,0,0,0,1],[0,1,1,1,0],[1,0,0,0,1],[1,0,0,0,1],[0,1,1,1,0]],57:[[0,1,1,1,0],[1,0,0,0,1],[1,0,0,0,1],[0,1,1,1,1],[0,0,0,0,1],[0,0,0,1,0],[0,1,1,0,0]],58:[[0,0,0,0,0],[0,0,0,0,0],[0,0,1,0,0],[0,0,0,0,0],[0,0,0,0,0],[0,0,1,0,0],[0,0,0,0,0]],59:[[0,0,0,0,0],[0,0,1,0,0],[0,0,0,0,0],[0,0,0,0,0],[0,0,1,0,0],[0,0,1,0,0],[0,1,0,0,0]],61:[[0,0,0,0,0],[0,0,0,0,0],[1,1,1,1,0],[0,0,0,0,0],[0,0,0,0,0],[1,1,1,1,0],[0,0,0,0,0]],63:[[0,1,1,1,0],[1,0,0,0,1],[0,0,0,0,1],[0,0,0,1,0],[0,0,1,0,0],[0,0,0,0,0],[0,0,1,0,0]],65:[[0,1,1,1,0],[1,0,0,0,1],[1,0,0,0,1],[1,1,1,1,1],[1,0,0,0,1],[1,0,0,0,1],[1,0,0,0,1]],66:[[1,1,1,1,0],[1,0,0,0,1],[1,0,0,0,1],[1,1,1,1,0],[1,0,0,0,1],[1,0,0,0,1],[1,1,1,1,0]],67:[[0,1,1,1,0],[1,0,0,0,1],[1,0,0,0,0],[1,0,0,0,0],[1,0,0,0,0],[1,0,0,0,1],[0,1,1,1,0]],68:[[1,1,1,1,0],[1,0,0,0,1],[1,0,0,0,1],[1,0,0,0,1],[1,0,0,0,1],[1,0,0,0,1],[1,1,1,1,0]],69:[[1,1,1,1,1],[1,0,0,0,0],[1,0,0,0,0],[1,1,1,1,0],[1,0,0,0,0],[1,0,0,0,0],[1,1,1,1,1]],70:[[1,1,1,1,1],[1,0,0,0,0],[1,0,0,0,0],[1,1,1,1,0],[1,0,0,0,0],[1,0,0,0,0],[1,0,0,0,0]],71:[[0,1,1,1,0],[1,0,0,0,1],[1,0,0,0,0],[1,0,0,0,0],[1,0,0,1,1],[1,0,0,0,1],[0,1,1,1,0]],72:[[1,0,0,0,1],[1,0,0,0,1],[1,0,0,0,1],[1,1,1,1,1],[1,0,0,0,1],[1,0,0,0,1],[1,0,0,0,1]],73:[[0,1,1,1,0],[0,0,1,0,0],[0,0,1,0,0],[0,0,1,0,0],[0,0,1,0,0],[0,0,1,0,0],[0,1,1,1,0]],74:[[0,0,1,1,1],[0,0,0,1,0],[0,0,0,1,0],[0,0,0,1,0],[0,0,0,1,0],[1,0,0,1,0],[0,1,1,0,0]],75:[[1,0,0,0,1],[1,0,0,1,0],[1,0,1,0,0],[1,1,0,0,0],[1,0,1,0,0],[1,0,0,1,0],[1,0,0,0,1]],76:[[1,0,0,0,0],[1,0,0,0,0],[1,0,0,0,0],[1,0,0,0,0],[1,0,0,0,0],[1,0,0,0,0],[1,1,1,1,1]],77:[[1,0,0,0,1],[1,1,0,1,1],[1,0,1,0,1],[1,0,1,0,1],[1,0,0,0,1],[1,0,0,0,1],[1,0,0,0,1]],78:[[1,0,0,0,1],[1,0,0,0,1],[1,1,0,0,1],[1,0,1,0,1],[1,0,0,1,1],[1,0,0,0,1],[1,0,0,0,1]],79:[[0,1,1,1,0],[1,0,0,0,1],[1,0,0,0,1],[1,0,0,0,1],[1,0,0,0,1],[1,0,0,0,1],[0,1,1,1,0]],80:[[1,1,1,1,0],[1,0,0,0,1],[1,0,0,0,1],[1,1,1,1,0],[1,0,0,0,0],[1,0,0,0,0],[1,0,0,0,0]],81:[[0,1,1,1,0],[1,0,0,0,1],[1,0,0,0,1],[1,0,0,0,1],[1,0,1,0,1],[1,0,0,1,0],[0,1,1,0,1]],82:[[1,1,1,1,0],[1,0,0,0,1],[1,0,0,0,1],[1,1,1,1,0],[1,0,1,0,0],[1,0,0,1,0],[1,0,0,0,1]],83:[[0,1,1,1,1],[1,0,0,0,0],[1,0,0,0,0],[0,1,1,1,0],[0,0,0,0,1],[0,0,0,0,1],[1,1,1,1,0]],84:[[1,1,1,1,1],[0,0,1,0,0],[0,0,1,0,0],[0,0,1,0,0],[0,0,1,0,0],[0,0,1,0,0],[0,0,1,0,0]],85:[[1,0,0,0,1],[1,0,0,0,1],[1,0,0,0,1],[1,0,0,0,1],[1,0,0,0,1],[1,0,0,0,1],[0,1,1,1,0]],86:[[1,0,0,0,1],[1,0,0,0,1],[1,0,0,0,1],[1,0,0,0,1],[0,1,0,1,0],[0,1,0,1,0],[0,0,1,0,0]],87:[[1,0,0,0,1],[1,0,0,0,1],[1,0,0,0,1],[1,0,0,0,1],[1,0,1,0,1],[1,0,1,0,1],[0,1,0,1,0]],88:[[1,0,0,0,1],[1,0,0,0,1],[0,1,0,1,0],[0,0,1,0,0],[0,1,0,1,0],[1,0,0,0,1],[1,0,0,0,1]],89:[[1,0,0,0,1],[1,0,0,0,1],[0,1,0,1,0],[0,0,1,0,0],[0,0,1,0,0],[0,0,1,0,0],[0,0,1,0,0]],90:[[1,1,1,1,1],[0,0,0,0,1],[0,0,0,1,0],[0,0,1,0,0],[0,1,0,0,0],[1,0,0,0,0],[1,1,1,1,1]],95:[[0,0,0,0,0],[0,0,0,0,0],[0,0,0,0,0],[0,0,0,0,0],[0,0,0,0,0],[0,0,0,0,0],[1,1,1,1,1]]},a0={44:{dy:2,dx:0},95:{dy:2,dx:0}},C=new U({name:"Mono_5x7",ascii_table:h0,ascii_modifiers:a0,symbol_width:5,symbol_height:7,backup_symbol_grid:[[1,1,1,1,1],[1,1,1,1,1],[1,1,1,1,1],[1,1,1,1,1],[1,1,1,1,1],[1,1,1,1,1],[1,1,1,1,1]],new_line_symbol:10,separator_symbol:32,default_inter_letter_width:2,default_inter_letter_height:6,default_gap:0,default_size:1}),l0={32:[[0,0,0,0,0],[0,0,0,0,0],[0,0,0,0,0],[0,0,0,0,0],[0,0,0,0,0],[0,0,0,0,0],[0,0,0,0,0],[0,0,0,0,0]],33:[[0,0,1,0,0],[0,0,1,0,0],[0,0,1,0,0],[0,0,1,0,0],[0,0,1,0,0],[0,0,1,0,0],[0,0,0,0,0],[0,0,1,0,0]],34:[[0,1,0,1,0],[0,1,0,1,0],[0,1,0,1,0],[0,0,0,0,0],[0,0,0,0,0],[0,0,0,0,0],[0,0,0,0,0],[0,0,0,0,0]],36:[[0,0,1,0,0],[0,1,1,1,0],[1,0,0,0,1],[0,1,1,0,0],[0,0,0,1,0],[1,0,0,0,1],[0,1,1,1,0],[0,0,1,0,0]],39:[[0,0,0,0,0],[0,0,1,0,0],[0,0,1,0,0],[0,0,1,0,0],[0,0,0,0,0],[0,0,0,0,0],[0,0,0,0,0],[0,0,0,0,0]],40:[[0,0,0,1,1],[0,0,1,0,0],[0,0,1,0,0],[0,0,1,0,0],[0,0,1,0,0],[0,0,1,0,0],[0,0,1,0,0],[0,0,0,1,1]],41:[[1,1,0,0,0],[0,0,1,0,0],[0,0,1,0,0],[0,0,1,0,0],[0,0,1,0,0],[0,0,1,0,0],[0,0,1,0,0],[1,1,0,0,0]],44:[[0,0,0,0,0],[0,0,0,0,0],[0,0,0,0,0],[0,0,0,0,0],[0,0,0,0,0],[0,0,0,1,0],[0,0,0,1,0],[0,0,1,0,0]],45:[[0,0,0,0,0],[0,0,0,0,0],[0,0,0,0,0],[0,1,1,1,0],[0,0,0,0,0],[0,0,0,0,0],[0,0,0,0,0],[0,0,0,0,0]],46:[[0,0,0,0,0],[0,0,0,0,0],[0,0,0,0,0],[0,0,0,0,0],[0,0,0,0,0],[0,0,0,0,0],[0,0,0,0,0],[0,0,1,0,0]],48:[[0,1,1,1,0],[1,0,0,0,1],[1,0,0,0,1],[1,0,1,0,1],[1,0,1,0,1],[1,0,0,0,1],[1,0,0,0,1],[0,1,1,1,0]],49:[[0,0,0,1,0],[0,0,1,1,0],[0,1,0,1,0],[1,0,0,1,0],[0,0,0,1,0],[0,0,0,1,0],[0,0,0,1,0],[0,0,0,1,0]],50:[[0,1,1,1,0],[1,0,0,0,1],[1,0,0,0,1],[0,0,0,1,0],[0,0,1,0,0],[0,1,0,0,0],[1,0,0,0,0],[1,1,1,1,1]],51:[[0,1,1,1,0],[1,0,0,0,1],[0,0,0,0,1],[0,0,1,1,0],[0,0,0,0,1],[0,0,0,0,1],[1,0,0,0,1],[0,1,1,1,0]],52:[[1,0,0,0,1],[1,0,0,0,1],[1,0,0,0,1],[1,1,1,1,1],[0,0,0,0,1],[0,0,0,0,1],[0,0,0,0,1],[0,0,0,0,1]],53:[[1,1,1,1,1],[1,0,0,0,0],[1,0,0,0,0],[1,1,1,1,0],[0,0,0,0,1],[0,0,0,0,1],[1,0,0,0,1],[0,1,1,1,0]],54:[[0,1,1,1,0],[1,0,0,0,1],[1,0,0,0,0],[1,1,1,1,0],[1,0,0,0,1],[1,0,0,0,1],[1,0,0,0,1],[0,1,1,1,0]],55:[[1,1,1,1,1],[0,0,0,0,1],[0,0,0,0,1],[0,0,0,1,0],[0,0,0,1,0],[0,0,1,0,0],[0,0,1,0,0],[0,0,1,0,0]],56:[[0,1,1,1,0],[1,0,0,0,1],[1,0,0,0,1],[0,1,1,1,0],[1,0,0,0,1],[1,0,0,0,1],[1,0,0,0,1],[0,1,1,1,0]],57:[[0,1,1,1,0],[1,0,0,0,1],[1,0,0,0,1],[0,1,1,1,1],[0,0,0,0,1],[0,0,0,0,1],[1,0,0,0,1],[0,1,1,1,0]],58:[[0,0,0,0,0],[0,0,0,0,0],[0,0,1,0,0],[0,0,0,0,0],[0,0,0,0,0],[0,0,1,0,0],[0,0,0,0,0],[0,0,0,0,0]],59:[[0,0,0,0,0],[0,0,0,0,0],[0,0,1,0,0],[0,0,0,0,0],[0,0,0,0,0],[0,0,1,0,0],[0,0,1,0,0],[0,1,0,0,0]],61:[[0,0,0,0,0],[0,0,0,0,0],[0,0,0,0,0],[1,1,1,1,0],[0,0,0,0,0],[0,0,0,0,0],[1,1,1,1,0],[0,0,0,0,0]],63:[[0,1,1,1,0],[1,0,0,0,1],[0,0,0,0,1],[0,0,0,1,0],[0,0,1,0,0],[0,0,1,0,0],[0,0,0,0,0],[0,0,1,0,0]],65:[[0,0,1,0,0],[0,1,0,1,0],[1,0,0,0,1],[1,0,0,0,1],[1,1,1,1,1],[1,0,0,0,1],[1,0,0,0,1],[1,0,0,0,1]],66:[[1,1,1,1,0],[1,0,0,0,1],[1,0,0,0,1],[1,1,1,1,0],[1,0,0,0,1],[1,0,0,0,1],[1,0,0,0,1],[1,1,1,1,0]],67:[[0,1,1,1,0],[1,0,0,0,1],[1,0,0,0,0],[1,0,0,0,0],[1,0,0,0,0],[1,0,0,0,0],[1,0,0,0,1],[0,1,1,1,0]],68:[[1,1,1,1,0],[1,0,0,0,1],[1,0,0,0,1],[1,0,0,0,1],[1,0,0,0,1],[1,0,0,0,1],[1,0,0,0,1],[1,1,1,1,0]],69:[[1,1,1,1,1],[1,0,0,0,0],[1,0,0,0,0],[1,1,1,1,0],[1,0,0,0,0],[1,0,0,0,0],[1,0,0,0,0],[1,1,1,1,1]],70:[[1,1,1,1,1],[1,0,0,0,0],[1,0,0,0,0],[1,1,1,1,0],[1,0,0,0,0],[1,0,0,0,0],[1,0,0,0,0],[1,0,0,0,0]],71:[[0,1,1,1,0],[1,0,0,0,1],[1,0,0,0,0],[1,0,0,0,0],[1,0,1,1,1],[1,0,0,0,1],[1,0,0,0,1],[0,1,1,1,0]],72:[[1,0,0,0,1],[1,0,0,0,1],[1,0,0,0,1],[1,1,1,1,1],[1,0,0,0,1],[1,0,0,0,1],[1,0,0,0,1],[1,0,0,0,1]],73:[[1,1,1,1,1],[0,0,1,0,0],[0,0,1,0,0],[0,0,1,0,0],[0,0,1,0,0],[0,0,1,0,0],[0,0,1,0,0],[1,1,1,1,1]],74:[[0,0,0,0,1],[0,0,0,0,1],[0,0,0,0,1],[0,0,0,0,1],[0,0,0,0,1],[1,0,0,0,1],[1,0,0,0,1],[0,1,1,1,0]],75:[[1,0,0,0,1],[1,0,0,1,0],[1,0,1,0,0],[1,1,0,0,0],[1,1,0,0,0],[1,0,1,0,0],[1,0,0,1,0],[1,0,0,0,1]],76:[[1,0,0,0,0],[1,0,0,0,0],[1,0,0,0,0],[1,0,0,0,0],[1,0,0,0,0],[1,0,0,0,0],[1,0,0,0,0],[1,1,1,1,1]],77:[[1,0,0,0,1],[1,1,0,1,1],[1,0,1,0,1],[1,0,1,0,1],[1,0,0,0,1],[1,0,0,0,1],[1,0,0,0,1],[1,0,0,0,1]],78:[[1,0,0,0,1],[1,1,0,0,1],[1,1,0,0,1],[1,0,1,0,1],[1,0,1,0,1],[1,0,0,1,1],[1,0,0,1,1],[1,0,0,0,1]],79:[[0,1,1,1,0],[1,0,0,0,1],[1,0,0,0,1],[1,0,0,0,1],[1,0,0,0,1],[1,0,0,0,1],[1,0,0,0,1],[0,1,1,1,0]],80:[[1,1,1,1,0],[1,0,0,0,1],[1,0,0,0,1],[1,1,1,1,0],[1,0,0,0,0],[1,0,0,0,0],[1,0,0,0,0],[1,0,0,0,0]],81:[[0,1,1,1,0],[1,0,0,0,1],[1,0,0,0,1],[1,0,0,0,1],[1,0,0,0,1],[1,0,1,0,1],[1,0,0,1,1],[0,1,1,1,1]],82:[[1,1,1,1,0],[1,0,0,0,1],[1,0,0,0,1],[1,1,1,1,0],[1,0,1,0,0],[1,0,0,1,0],[1,0,0,0,1],[1,0,0,0,1]],83:[[0,1,1,1,0],[1,0,0,0,1],[1,0,0,0,1],[0,1,1,0,0],[0,0,0,1,0],[1,0,0,0,1],[1,0,0,0,1],[0,1,1,1,0]],84:[[1,1,1,1,1],[0,0,1,0,0],[0,0,1,0,0],[0,0,1,0,0],[0,0,1,0,0],[0,0,1,0,0],[0,0,1,0,0],[0,0,1,0,0]],85:[[1,0,0,0,1],[1,0,0,0,1],[1,0,0,0,1],[1,0,0,0,1],[1,0,0,0,1],[1,0,0,0,1],[1,0,0,0,1],[0,1,1,1,0]],86:[[1,0,0,0,1],[1,0,0,0,1],[1,0,0,0,1],[1,0,0,0,1],[1,0,0,0,1],[1,0,0,0,1],[0,1,0,1,0],[0,0,1,0,0]],87:[[1,0,0,0,1],[1,0,0,0,1],[1,0,0,0,1],[1,0,0,0,1],[1,0,1,0,1],[1,0,1,0,1],[1,1,0,1,1],[1,0,0,0,1]],88:[[1,0,0,0,1],[1,0,0,0,1],[0,1,0,1,0],[0,0,1,0,0],[0,1,0,1,0],[1,0,0,0,1],[1,0,0,0,1],[1,0,0,0,1]],89:[[1,0,0,0,1],[1,0,0,0,1],[1,0,0,0,1],[0,1,0,1,0],[0,0,1,0,0],[0,0,1,0,0],[0,0,1,0,0],[0,0,1,0,0]],90:[[1,1,1,1,1],[0,0,0,0,1],[0,0,0,1,0],[0,0,1,0,0],[0,1,0,0,0],[0,1,0,0,0],[1,0,0,0,0],[1,1,1,1,1]],95:[[0,0,0,0,0],[0,0,0,0,0],[0,0,0,0,0],[0,0,0,0,0],[0,0,0,0,0],[0,0,0,0,0],[0,0,0,0,0],[1,1,1,1,1]]},c0={44:{dy:2,dx:0},95:{dy:2,dx:0}};new U({name:"Mono_5x8",ascii_table:l0,ascii_modifiers:c0,symbol_width:5,symbol_height:8,backup_symbol_grid:[[1,1,1,1,1],[1,1,1,1,1],[1,1,1,1,1],[1,1,1,1,1],[1,1,1,1,1],[1,1,1,1,1],[1,1,1,1,1],[1,1,1,1,1]],new_line_symbol:10,separator_symbol:32,default_inter_letter_width:2,default_inter_letter_height:6,default_gap:0,default_size:1});class G{constructor(t){r(this,"_hex");r(this,"_cache_rgb");r(this,"_cache_rgb_string");r(this,"_cache_hex_string");this._hex=t}get rgb(){if(!this._cache_rgb){const t=this._hex;this._cache_rgb=[t>>16&255,t>>8&255,t&255]}return this._cache_rgb}get rgb_string(){return this._cache_rgb_string||(this._cache_rgb_string="rgb("+this.rgb.join(",")+")"),this._cache_rgb_string}get hex(){return this._hex}get hex_string(){return this._cache_hex_string||(this._cache_hex_string="#"+this.rgb.map(t=>t.toString(16).padStart(2,"0")).join("")),this._cache_hex_string}}class d0{constructor(t){r(this,"raw_data");r(this,"code_separator",32);r(this,"code_new_line",10);this.raw_data=this.parse(t)}get data(){return this.raw_data}toHex(t){return t.toUpperCase().split("").map(e=>e.charCodeAt(0))}parse(t){const e=this.toHex(t),i=[],s=[],n=()=>{s.length>0&&(i.push(new P({type:"chars",chars:s.slice()})),s.length=0)};for(let o=0;o<e.length+1;o++)o===e.length?n():e[o]===this.code_separator?(n(),i.push(new P({type:"separator"}))):e[o]===this.code_new_line?(n(),i.push(new P({type:"new_line"}))):s.push(e[o]);return i}}class P{constructor(t){r(this,"type");r(this,"chars");const{type:e,chars:i}=t;this.type=e,this.chars=i??[]}}const B=p=>`0x${p.toString(16).toUpperCase().padStart(2,"0")}`;class f0{constructor(t){r(this,"context");r(this,"font");this.context=t.context,this.font=t.font}clear(t,e){if(typeof t!="number")return;const{context:i}=this,s=new G(t);i.fillStyle=s.hex_string,i.fillRect(e.x,e.y,e.width,e.height)}*_write(t,{area:e,size:i,gap:s,color:n=0,clear_background_color:o,padding:l=0,inter_letter_height:d,inter_letter_width:h,word_break:a=!0}){const c=new d0(t);this.clear(o,e);const{font:u}=this,_=i??u.default_size??1,g=s??u.default_gap??0,b=h??u.default_inter_letter_width??0,f=d??u.default_inter_letter_height??0,w=e.x+l,x=e.y+l,m=e.x+e.width-l,z=e.y+e.height-l;let v=x,E=w;const X=u.symbol_width*(_+g),H=u.symbol_height*(_+g),D=u.symbol_width*(_+g)+b,I=u.symbol_height*(_+g)+f,N=new G(n);for(const L of c.data){if(L.type==="new_line"){E=w,v+=I;continue}if(L.type==="chars"){const J=L.chars.length*X+(b*L.chars.length-1);if(!(E+J<m)){if(!a){console.warn("The text is too long.");break}E=w,v+=I}if(!(v+H<z)){console.warn(`Not enough space in the area to insert a group [${L.chars.map(B)}].`);break}for(const Y of L.chars)yield this.writeSymbol(Y,{x:E,y:v,color:N,size:_,gap:g}),E+=D;yield this.writeSymbol(u.separator_symbol,{x:E,y:v,color:N,size:_,gap:g}),E+=D}}}writeSymbol(t,e){var f,w;const{context:i,font:s}=this;let n=s.ascii_table[t];t in s.ascii_table||(console.warn(`Symbol [${B(t)}] is not supported in the "${s.name}" font.`),n=s.backup_symbol_grid);const{ascii_modifiers:o,symbol_width:l,symbol_height:d}=s,{size:h,gap:a,color:c,x:u,y:_}=e,g=((f=o==null?void 0:o[t])==null?void 0:f.dx)??0,b=((w=o==null?void 0:o[t])==null?void 0:w.dy)??0;i.fillStyle=c.hex_string;for(let x=0;x<d;x++){const m=_+b*(h+a)+x*(h+a);for(let z=0;z<l;z++){const v=u+g*(h+a)+z*(h+a);n[x][z]===o0&&i.fillRect(v,m,h,h)}}}animate(t,e,{fps:i=60}={}){return new Promise(s=>{const n=this._write(t,e),o=1e3/i;let l=-1,d=-1;const h=async()=>{l=requestAnimationFrame(h);const a=Date.now(),c=a-d;c<o||(d=a-c%o,n.next().done&&(cancelAnimationFrame(l),s()))};requestAnimationFrame(h)})}write(t,e){const i=this._write(t,e);for(;i.next&&!i.next().done;);}}class p0{constructor({context:t}){r(this,"context");r(this,"writer");r(this,"symbolWidth");r(this,"size",3);r(this,"gap",0);r(this,"y0");r(this,"y1");r(this,"x0");r(this,"x1");this.context=t,this.writer=new f0({context:t,font:C}),this.symbolWidth=C.symbol_width*2+(C.default_inter_letter_width??0),this.y0=16,this.x0=15*(1+15)+15*2,this.y1=510,this.x1=15*(1+15)+15*2+140,this.drawBoard()}drawBoard(){const{symbolWidth:t}=this;this.writer.write("LEVEL",{size:2,gap:0,color:10066329,padding:4,area:{x:270+t*6,y:11,width:140,height:23}}),this.writer.write("SCORE",{size:2,gap:0,color:10066329,padding:4,area:{x:270+t*6,y:80,width:140,height:23}}),this.writer.write("NEXT",{size:2,gap:0,color:10066329,padding:4,area:{x:270+t*7,y:155,width:140,height:23}}),this.writer.write("RECORDS",{size:2,gap:0,color:10066329,padding:4,area:{x:270+t*4,y:265,width:140,height:23}})}drawGameOver(){const{writer:t}=this;t.animate("GAME OVER!",{area:{x:14,y:190,width:240,height:50},padding:10,size:4,clear_background_color:14540253,color:0},{fps:15})}updateScore(t){const{symbolWidth:e,writer:i}=this,s=String(t);i.write(s,{size:2,gap:0,color:0,clear_background_color:16777215,padding:4,area:{x:270+e*(11-s.length),y:105,width:140,height:23}})}updateLevel(t){const{symbolWidth:e,writer:i}=this,s=String(t);i.write(s,{size:2,gap:0,color:0,clear_background_color:16777215,padding:4,area:{x:270+e*(11-s.length),y:35,width:140,height:23}})}updateNext(t){const{context:e,y0:i,x0:s}=this,n=15,l=n+1,d=i+170,h=s+116+l,a=t.grid[0].length;e.fillStyle="#fff",e.fillRect(330,d,124,60),e.fillStyle="#000";for(const[c,u]of t.points)e.fillRect(h+u*l-a*l,d+c*l,n,n)}updateRecords(t){const{context:e,writer:i}=this,s=C.symbol_width+(C.default_inter_letter_width??0),n=300;e.fillStyle="#fff",e.fillRect(270,n,140,198);for(let o=0;o<t.length;o++){const[l,d]=t[o],h=String(d),a=n+o*40;i.write(l,{area:{x:270+s*(19-l.length),y:a,width:140,height:23},padding:4,clear_background_color:16777215,color:0,size:1,gap:0}),i.write(h,{area:{x:270+s*(19-h.length),y:a+15,width:140,height:23},padding:4,clear_background_color:16777215,color:10066329,size:1,gap:0})}}}const u0=[["coolkid",1e5],["zer0",5e4],["max",4e4],["droid",25e3],["crasher",1e4]];class g0{constructor(){r(this,"records",[]);r(this,"count",5);this.records=this.read()}read(){let t=[];try{const e=localStorage.getItem("records");e&&(t=JSON.parse(e))}catch{}return t&&t.length?t:u0}save(){localStorage.setItem("records",JSON.stringify(this.records))}isRecord(t){const e=Math.min(...this.records.map(i=>i[1]));return t>=e}saveRecord(t){const e=prompt("Congratulations! Write your nickname.")??"anonymous";let i=0;for(let s=1;s<this.records.length;s++)t<=this.records[s-1][1]&&t>this.records[s][1]&&(i=s);for(this.records.splice(i,0,[e,t]);this.records.length>this.count;)this.records.pop();this.save()}}class _0{constructor(t){r(this,"grid");r(this,"dy",0);r(this,"dx",0);this.grid=t.map(e=>[...e])}get points(){const t=[];for(let e=0;e<this.grid.length;e++)for(let i=0;i<this.grid.length;i++)this.grid[e][i]===1&&t.push([e+this.dy,i+this.dx]);return t}move({dy:t=0,dx:e=0}){this.dy+=t,this.dx+=e}rotate(t=!0){const e=this.grid.length;for(let i=0;i<e;i++)for(let s=i;s<e;s++){const n=this.grid[i][s];this.grid[i][s]=this.grid[s][i],this.grid[s][i]=n}if(t)for(let i=0;i<this.grid.length;i++)for(let s=0;s<Math.floor(this.grid[0].length/2);s++){const n=this.grid[i][s];this.grid[i][s]=this.grid[i][this.grid[0].length-1-s],this.grid[i][this.grid[0].length-1-s]=n}else for(let i=0;i<this.grid[0].length;i++)for(let s=0;s<Math.floor(this.grid.length/2);s++){const n=this.grid[s][i];this.grid[s][i]=this.grid[this.grid.length-1-s][i],this.grid[this.grid.length-1-s][i]=n}}}const V={J:[[0,1,0],[0,1,0],[1,1,0]],I:[[0,0,0,0],[1,1,1,1],[0,0,0,0],[0,0,0,0]],O:[[1,1],[1,1]],L:[[0,1,0],[0,1,0],[0,1,1]],Z:[[1,1,0],[0,1,1],[0,0,0]],T:[[0,1,0],[1,1,1],[0,0,0]],S:[[0,1,1],[1,1,0],[0,0,0]]};function y0(p){return new _0(V[p])}function q(){const p=Math.floor(Math.random()*7),t=Object.keys(V)[p];return y0(t)}class m0{constructor({canvas:t}){r(this,"board");r(this,"renderer");r(this,"keyboard");r(this,"panel");r(this,"records");r(this,"frameId",-1);r(this,"timestamp",-1);r(this,"speedModifier",5);r(this,"animationFrames",null);r(this,"activeKey",null);r(this,"verticalMovementTimestamp",-1);r(this,"verticalSpeed",30);r(this,"ticks",0);r(this,"collapseCount",0);r(this,"score",0);r(this,"level",1);r(this,"nextShape");r(this,"currentShape",null);r(this,"onKeyUp",()=>{this.activeKey=null});r(this,"onKey",({key:t})=>{if(this.activeKey=t,this.currentShape&&(t==="L"||t==="R")){const e=t==="L"?-1:1;this.currentShape.move({dx:e}),this.board.canPlaceShape(this.currentShape)||this.currentShape.move({dx:-e})}else t==="U"&&this.currentShape&&(this.currentShape.rotate(!0),this.board.canPlaceShape(this.currentShape)||this.currentShape.rotate(!1))});r(this,"tick",()=>{this.frameId=requestAnimationFrame(this.tick);const t=Date.now(),e=t-this.timestamp;if(this.processVerticalMovement(),!(e<this.speed)){if(this.timestamp=t-e%this.speed,this.ticks+=1,[100,500,1e3,2500,5e3,7500,1e4,15e3,2e4].includes(this.ticks)&&(this.level+=1,this.speedModifier+=1,this.panel.updateLevel(this.level)),this.board.collapsed){this.animationFrames===null&&(this.animationFrames=3),this.animationFrames-=1,this.animationFrames===0&&(this.animationFrames=null,this.board.collapseRows(),this.collapseCount+=1,this.score+=100*this.collapseCount*this.level);return}if(this.collapseCount=0,!this.currentShape){this.currentShape=this.nextShape,this.nextShape=q(),this.panel.updateNext(this.nextShape),this.currentShape.move({dy:0,dx:Math.floor(this.board.width/2)-Math.floor(this.currentShape.grid.length/2)}),this.board.shape=this.currentShape;return}this.currentShape.move({dy:1}),this.board.canPlaceShape(this.currentShape)?this.score+=this.level:(this.currentShape.move({dy:-1}),this.currentShape.dy===0?(this.stop(),this.renderer.stop(),this.panel.drawGameOver(),this.records.isRecord(this.score)&&(this.records.saveRecord(this.score),this.panel.updateRecords(this.records.records))):(this.board.attachShape(),this.board.shape=null,this.currentShape=null,this.score+=this.level*10)),this.panel.updateScore(this.score)}});const e=t.getContext("2d");if(!e)throw new Error("Can not get a canvas context.");this.board=new t0,this.renderer=new s0({board:this.board,canvas:t,context:e}),this.panel=new p0({context:e}),this.records=new g0,this.keyboard=new i0,this.nextShape=q()}get speed(){return 1e3/this.speedModifier}init(){const{keyboard:t,renderer:e}=this,i=t.init();return t.events.on("key",this.onKey),t.events.on("keyUp",this.onKeyUp),e.start(),this.start(),this.panel.updateLevel(this.level),this.panel.updateRecords(this.records.records),()=>{i(),t.events.off("key",this.onKey),t.events.off("keyUp",this.onKeyUp),cancelAnimationFrame(this.frameId),e.stop(),this.stop()}}start(){this.tick()}stop(){cancelAnimationFrame(this.frameId)}processVerticalMovement(){const t=Date.now(),e=t-this.verticalMovementTimestamp,i=this.activeKey;!this.currentShape||i!=="D"||e<this.verticalSpeed||(this.verticalMovementTimestamp=t-e%this.verticalSpeed,this.currentShape.move({dy:1}),this.board.canPlaceShape(this.currentShape)||this.currentShape.move({dy:-1}))}}const w0=new m0({canvas:document.getElementById("canvas")});w0.init();
